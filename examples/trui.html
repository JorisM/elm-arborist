<!DOCTYPE html>
<html>
  <head>
    <!-- ! EXPERIMENTAL ! a visual/hybrid user interface programming tool. See the `Conversation.elm` example for a gentle introduction to Arborist. -->
    <title>trui | visual ui editor</title>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/codemirror.min.css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/theme/monokai.min.css"/>
    <style>
      #playground-container {
        position: absolute;
        background-color: #FFF;
        top: 0;
        left: 50%;
        width: 50%;
        height: 100%;
        z-index: 10000;
        border-left: 2px solid #dedede;
      }

      pre {
        padding: 20;
      }

      pre * {
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div id="elm-container"></div>
    <div id="playground-container">
      <pre>
        <code>
        </code>
      </pre>
    </div> 
    <script src="/_compile/Trui.elm"></script>
    <script>
      var app = Elm.Trui.embed(document.getElementById("elm-container"))
      var urls = [
        "https://cdnjs.cloudflare.com/ajax/libs/react/16.2.0/umd/react.development.js",
        "https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.2.0/umd/react-dom.development.js",
        "https://unpkg.com/@babel/standalone/babel.min.js"
      ]
      function load(url) {
        return new Promise(function(resolve, reject) {
          var scriptElement = document.createElement("script")
          scriptElement.src = url
          scriptElement.onload = resolve
          document.body.appendChild(scriptElement)
        })
      }
      function start() {
        app.ports.code.subscribe(msg => {
          const code = Babel.transform(msg.sourcecode, {
            presets: ["es2015", "react"]
          })
          document.querySelector("code").textContent = code.code
          const prevScript = document.querySelector("#compiled")
          if (prevScript) {
            prevScript.parentNode && prevScript.parentNode.removeChild(prevScript)
          }
          const script = document.createElement("script")
          script.id = "compiled"
          script.textContent = code.code
          document.body.appendChild(script)
        })
      }
      load(urls[0])
        .then(a => load(urls[1]))
        .then(a => load(urls[2]))
        .then(start)
  </script>
  </body>
</html>

